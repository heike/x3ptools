<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="The x3p file format  is specified in ISO standard 5436:2000 to 
    describe 3d surface measurements. x3ptools allows reading, writing and 
    basic modifications to the 3D surface measurements.">
<title>Tools for Working with 3D Surface Measurements • x3ptools</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Tools for Working with 3D Surface Measurements">
<meta property="og:description" content="The x3p file format  is specified in ISO standard 5436:2000 to 
    describe 3d surface measurements. x3ptools allows reading, writing and 
    basic modifications to the 3D surface measurements.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">x3ptools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/heike/x3ptools/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="x3ptools-">x3ptools <img src="reference/figures/x3ptools.png" align="right" width="120"><a class="anchor" aria-label="anchor" href="#x3ptools-"></a>
</h1></div>
<p>The x3p file format is specified in ISO standard 25178-72:2017/AMD 1:2020 (based on ISO ISO5436 – 2000) describe 3d surface measurements. This package allows reading, writing and basic modifications to the 3D surface measurements.</p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<p><code>x3ptools</code> is available from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"x3ptools"</span><span class="op">)</span></span></code></pre></div>
<p>The development version is available from Github:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"heike/x3ptools"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="the-file-format">The file format<a class="anchor" aria-label="anchor" href="#the-file-format"></a>
</h2>
<p>The x3p file format is an xml based file format created to describe digital surface measurements. x3p has been developed by OpenFMC (Open Forensic Metrology Consortium, see <a href="https://www.open-fmc.org/" class="external-link uri">https://www.open-fmc.org/</a>) and has been adopted as 25178-72:2017/AMD 1:2020. x3p files are a zip archive of a directory consisting of an xml file of meta information and a matrix of numeric surface measurements.</p>
<div class="section level3">
<h3 id="x3p-objects">x3p objects<a class="anchor" aria-label="anchor" href="#x3p-objects"></a>
</h3>
<p>Internally, x3p objects are stored as a list consisting of the surface matrix (the measurements) and meta information in four records: header info, feature info, general info, and matrix info:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/heike/x3ptools" class="external-link">x3ptools</a></span><span class="op">)</span></span>
<span><span class="va">logo</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/x3p_read.html">x3p_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"csafe-logo.x3p"</span>, package<span class="op">=</span><span class="st">"x3ptools"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">logo</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="do">## [1] "header.info"    "surface.matrix" "feature.info"   "general.info"  </span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="do">## [5] "matrix.info"    "other.info"</span></span></code></pre></div>
<p>The four info objects specify the information for Record1 through Record4 in the xml file. An example for an xml file is provided with the package and can be accessed as <code>system.file("templateXML.xml", package="x3ptools")</code>.</p>
<p><code>header.info</code> contains the information relevant to interpret locations for the surface matrix:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logo</span><span class="op">$</span><span class="va">header.info</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">## $sizeY</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="do">## [1] 419</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="do">## $sizeX</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="do">## [1] 741</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="do">## $incrementY</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="do">## [1] 6.45e-07</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="do">## $incrementX</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="do">## [1] 6.45e-07</span></span></code></pre></div>
<p><code>matrix.info</code> expands on <code>header.info</code> and provides the link to the surface measurements in binary format.</p>
<p><code>general.info</code> consists of information on how the data was captured, i.e. both author and capturing device are specified here.</p>
<p><code>feature.info</code> is informed by the header info and provides the structure for storing the information.</p>
<p>While these pieces can be changed and adapted manually, it is more convenient to save information on the capturing device and the creator in a separate template and bind measurements and meta information together in the command <code>x3p_addtemplate</code>.</p>
</div>
<div class="section level3">
<h3 id="reading-and-writing-x3p-files">Reading and writing x3p files<a class="anchor" aria-label="anchor" href="#reading-and-writing-x3p-files"></a>
</h3>
<p><code>x3p_read</code> and <code>x3p_write</code> are the two functions allows us to read x3p files and write to x3p files.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logo</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/x3p_read.html">x3p_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"csafe-logo.x3p"</span>, package<span class="op">=</span><span class="st">"x3ptools"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">logo</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="do">## [1] "header.info"    "surface.matrix" "feature.info"   "general.info"  </span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="do">## [5] "matrix.info"    "other.info"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level3">
<h3 id="visualizing-x3p-objects">Visualizing x3p objects<a class="anchor" aria-label="anchor" href="#visualizing-x3p-objects"></a>
</h3>
<p>The function <code>x3p_image</code> uses <code>rgl</code> to render a 3d object in a separate window. The user can then interact with the 3d surface (zoom and rotate):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/x3p_image.html">x3p_image</a></span><span class="op">(</span><span class="va">logo</span>, size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">741</span>,<span class="fl">419</span><span class="op">)</span>, zoom<span class="op">=</span><span class="fl">0.5</span>, useNULL<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/rglwidget.html" class="external-link">rglwidget</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/logo-rgl.png" width="360"></p>
<p>In case a file name is specified in the function call the resulting surface is saved in a file (the extension determines the actual file format of the image).</p>
<div class="section level4">
<h4 id="helper-lines">Helper lines<a class="anchor" aria-label="anchor" href="#helper-lines"></a>
</h4>
<p><code>x3p_image_grid</code> lays a regularly spaced grid of lines over the surface of the scan. Lines are drawn <code>spaces</code> apart (50 microns by default in y direction and 100 microns in x direction). Every fifth and tenth lines are colored differently to ease a visual assessment of distance.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logoplus</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/x3p_add_grid.html">x3p_add_grid</a></span><span class="op">(</span><span class="va">logo</span>, spaces<span class="op">=</span><span class="fl">50e-6</span>, </span>
<span>                         size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span>, color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey50"</span>, <span class="st">"black"</span>, <span class="st">"darkred"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/x3p_image.html">x3p_image</a></span><span class="op">(</span><span class="va">logoplus</span>, size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">741</span>,<span class="fl">419</span><span class="op">)</span>, zoom<span class="op">=</span><span class="fl">0.5</span>, useNULL<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/rglwidget.html" class="external-link">rglwidget</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/logo-rgl-grid.png" width="350"></p>
</div>
</div>
<div class="section level3">
<h3 id="casting-between-data-types">Casting between data types<a class="anchor" aria-label="anchor" href="#casting-between-data-types"></a>
</h3>
<p>The functions <code>x3p_to_df</code> and <code>df_to_x3p</code> allow casting between an x3p format and an x-y-z data set:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logo_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/x3p_to_df.html">x3p_to_df</a></span><span class="op">(</span><span class="va">logo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">logo_df</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="do">##           x          y value</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="do">## 1 0.000e+00 0.00026961 4e-07</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="do">## 2 6.450e-07 0.00026961 4e-07</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="do">## 3 1.290e-06 0.00026961 4e-07</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="do">## 4 1.935e-06 0.00026961 4e-07</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="do">## 5 2.580e-06 0.00026961 4e-07</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="do">## 6 3.225e-06 0.00026961 4e-07</span></span></code></pre></div>
<p>When converting from the x3p format to a data frame, the values from the surface matrix are interpreted as heights (saved as <code>value</code>) on an x-y grid. The dimension of the matrix sets the number of different x and y levels, the information in <code>header.info</code> allows us to scale the levels to the measured quantities. Similarly, when moving from a data frame to a surface matrix, the assumption is that measurements are taken on an equi-spaced and complete grid of x-y values. The information on the resolution (i.e. the spacing between consecutive x and y locations) is saved in form of the header info, which is added to the list. General info and feature info can not be extracted from the measurements, but have to be recorded with other means.</p>
<p>Once data is in a regular data frame, we can use our regular means to visualize these raster images, e.g. using <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">logo_df</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span> x<span class="op">=</span> <span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, fill<span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>midpoint<span class="op">=</span><span class="fl">4e-7</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-11-1.png"><!-- --></p>
</div>
<div class="section level3">
<h3 id="elementary-operations">Elementary operations<a class="anchor" aria-label="anchor" href="#elementary-operations"></a>
</h3>
<div class="section level4">
<h4 id="rotation-and-transposition">Rotation and Transposition<a class="anchor" aria-label="anchor" href="#rotation-and-transposition"></a>
</h4>
<p><code>x3p_rotate</code> rotates an x3p image counter-clockwise by angle in degrees, <code>x3p_transpose</code> transposes the surface matrix of an image and updates the corresponding meta information. The function <code>x3p_flip_y</code> is a combination of transpose and rotation, that allows to flip the direction of the y axis to move easily from legacy ISO x3p scans to ones conforming to the most recent ISO standard.</p>
</div>
<div class="section level4">
<h4 id="sampling">Sampling<a class="anchor" aria-label="anchor" href="#sampling"></a>
</h4>
<p><code>x3p_sample</code> allows to sub-sample an x3p object to get a lower resolution image. In <code>x3p_sample</code> we need to set a sampling factor. A sample factor <code>mX</code> of 2 means that we only use every 2nd value of the surface matrix, <code>mX</code> of 5 means, we only use every fifth value:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">logo</span><span class="op">$</span><span class="va">surface.matrix</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="do">## [1] 741 419</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logo_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/x3p_sample.html">x3p_sample</a></span><span class="op">(</span><span class="va">logo</span>, m<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">logo_sample</span><span class="op">$</span><span class="va">surface.matrix</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="do">## [1] 149  84</span></span></code></pre></div>
<p>Parameter <code>mY</code> can be specified separately from <code>mX</code> for a different sampling rate in y direction. We can also use different offsets in x and y direction by specifying <code>offsetX</code> and/or <code>offsetY</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/x3p_sample.html">x3p_sample</a></span><span class="op">(</span><span class="va">logo</span>, m<span class="op">=</span><span class="fl">5</span>, offset<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">logo_sample</span><span class="op">$</span><span class="va">surface.matrix</span><span class="op">[</span><span class="op">-</span><span class="fl">149</span>,<span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">sample2</span><span class="op">$</span><span class="va">surface.matrix</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="do">## [1] 0.8639308</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="interpolation">Interpolation<a class="anchor" aria-label="anchor" href="#interpolation"></a>
</h4>
<p><code>x3p_interpolate</code> allows, like <code>x3p_sample</code>, to create a new x3p file at a new resolution, as specified in the parameters <code>resx</code> and <code>resy</code>. The new resolution should be lower (i.e. larger values for <code>resx</code> and <code>resy</code>) than the resolution specified as <code>IncrementX</code> and <code>IncrementY</code> in the header info of the x3p file. <code>x3p_interpolate</code> can also be used to interpolate missing values (set parameter <code>maxgap</code> according to specifications in <code><a href="https://rdrr.io/pkg/zoo/man/na.approx.html" class="external-link">zoo::na.approx</a></code>).</p>
</div>
</div>
<div class="section level3">
<h3 id="inspecting-and-modifying-meta-information">Inspecting and modifying meta information<a class="anchor" aria-label="anchor" href="#inspecting-and-modifying-meta-information"></a>
</h3>
<p>The four records of header info, feature info, general info, and matrix info of an x3p object contain meta information relevant to the scan. <code>x3p_show_xml</code> allows the user to specify a search term and then proceeds to go through all records for a matching term. As a result any matching elements from the meta file are shown:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logo</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="reference/x3p_show_xml.html">x3p_show_xml</a></span><span class="op">(</span><span class="st">"axis"</span><span class="op">)</span> <span class="co"># three axes are defined</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="do">## $Axes.CX.AxisType</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="do">## [1] "I"</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="do">## $Axes.CY.AxisType</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="do">## [1] "I"</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="do">## $Axes.CZ.AxisType</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="do">## [1] "A"</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logo</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="reference/x3p_show_xml.html">x3p_show_xml</a></span><span class="op">(</span><span class="st">"creator"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="do">## $Creator</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="do">## [1] "Heike Hofmann, CSAFE"</span></span></code></pre></div>
<p>If a search term identifies a single element, <code>x3p_modify_xml</code> allows the user to update the corresponding meta information:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logo</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="reference/x3p_modify_xml.html">x3p_modify_xml</a></span><span class="op">(</span><span class="st">"creator"</span>, <span class="st">"I did this"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="do">## x3p object</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="do">## Instrument: N/A </span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="do">## size (width x height): 741 x 419 in pixel </span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="do">## resolution: 6.4500e-07 x 6.4500e-07 </span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="do">## Creator: I did this </span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="do">## Comment: image rendered from the CSAFE logo</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-and-modifying-masks">Adding and modifying masks<a class="anchor" aria-label="anchor" href="#adding-and-modifying-masks"></a>
</h3>
<div class="section level4">
<h4 id="images-as-masks">Images as masks<a class="anchor" aria-label="anchor" href="#images-as-masks"></a>
</h4>
<p>A mask is used to markup regions of the surface - the mask can then be used to overlay the rendered surface with color.</p>
<p>Below is a 3d surface of a part of a bullet surface is shown. Some regions are marked up: the bronze colored area is an area with strong striae (vertical lines engraved on the bullet as it moves through the barrel of the handgun when fired), areas in dark blue show groove engraved areas, the light blue area shows break off at the bottom of the bullet, and the pink area marks an area without striae:</p>
<p><img src="reference/figures/markup.png" width="750"></p>
<p>Any image can serve as a mask, the command <code>x3p_add_mask</code> allows to add a raster image as a mask for a x3p object:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logo</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/x3p_read.html">x3p_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"csafe-logo.x3p"</span>, package<span class="op">=</span><span class="st">"x3ptools"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">color_logo</span> <span class="op">&lt;-</span> <span class="fu">png</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/png/man/readPNG.html" class="external-link">readPNG</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"csafe-color.png"</span>, package<span class="op">=</span><span class="st">"x3ptools"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">logoplus</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/x3p_add_mask.html">x3p_add_mask</a></span><span class="op">(</span><span class="va">logo</span>, mask <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/as.raster.html" class="external-link">as.raster</a></span><span class="op">(</span><span class="va">color_logo</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/x3p_image.html">x3p_image</a></span><span class="op">(</span><span class="va">logoplus</span>, size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">741</span>, <span class="fl">419</span><span class="op">)</span>, zoom<span class="op">=</span><span class="fl">0.5</span>, multiply <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/logo-color.png" width="655"></p>
<p>Some masks are more informative than others, but the only requirement for images is that they are of the right size.</p>
<p><img src="reference/figures/csafe-leopard.png" width="49%"><img src="reference/figures/csafe-island.png" width="49%"></p>
</div>
<div class="section level4">
<h4 id="editing-masks">Editing masks<a class="anchor" aria-label="anchor" href="#editing-masks"></a>
</h4>
<p>Masks are raster images. Any change to the raster manifests as a change in the surface color of the corresponding scan. We suggest using the <code>magick</code> package to manipulate masks.</p>
<p>Additionally, vertical and horizontal lines can be added in the masks using the commands <code>x3p_add_vline</code> and <code>x3p_add_hline</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logo</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/x3p_read.html">x3p_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"csafe-logo.x3p"</span>, package<span class="op">=</span><span class="st">"x3ptools"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">logoplus</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/x3p_add_hline.html">x3p_add_hline</a></span><span class="op">(</span><span class="va">logo</span>, yintercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13e-5</span>,<span class="fl">19.5e-5</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"cyan"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/x3p_image.html">x3p_image</a></span><span class="op">(</span><span class="va">logoplus</span>, size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">741</span>, <span class="fl">419</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, zoom<span class="op">=</span><span class="fl">0.5</span>, multiply <span class="op">=</span> <span class="fl">30</span>, file<span class="op">=</span><span class="st">"man/figures/logo-lines.png"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/logo-lines.png" width="370"></p>
</div>
</div>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=x3ptools" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/heike/x3ptools/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/heike/x3ptools/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing x3ptools</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Heike Hofmann <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0001-6216-5183" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Susan Vanderplas <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-3803-0972" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Ganesh Krishnan <br><small class="roles"> Author </small>  </li>
<li>Eric Hare <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-4277-3146" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://CRAN.R-project.org/package=x3ptools" class="external-link"><img src="https://www.r-pkg.org/badges/version/x3ptools" alt="CRAN status"></a></li>
<li><a href="https://r-pkg.org/pkg/x3ptools" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/last-month/x3ptools?color=blue" alt="CRAN RStudio mirror downloads"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a></li>
<li><a href="https://github.com/heike/x3ptools/commits/main" class="external-link"><img src="https://img.shields.io/badge/last%20change-2024--02--22-yellowgreen.svg" alt="Last-changedate"></a></li>
<li><a href="https://app.codecov.io/gh/heike/x3ptools" class="external-link"><img src="https://codecov.io/gh/heike/x3ptools/graph/badge.svg?token=80NyJNOg5b" alt="Codecov test coverage"></a></li>
<li><a href="https://github.com/heike/x3ptools/actions" class="external-link"><img src="https://github.com/heike/x3ptools/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Heike Hofmann, Susan Vanderplas, Ganesh Krishnan, Eric Hare.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
